// Generated by IcedCoffeeScript 1.8.0-d
(function() {
  var StorageEvents,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  StorageEvents = (function() {
    function StorageEvents() {
      this.__trigger = __bind(this.__trigger, this);
      this.trigger = __bind(this.trigger, this);
      this.on = __bind(this.on, this);
    }

    StorageEvents.prototype.events = [];

    StorageEvents.prototype.on = function(eventNames, func) {
      var eventName, _i, _len, _ref, _results;
      _ref = eventNames.split(",");
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        eventName = _ref[_i];
        if (this.events[eventName] === void 0) {
          this.events[eventName] = [];
        }
        _results.push(this.events[eventName].push(func));
      }
      return _results;
    };

    StorageEvents.prototype.trigger = function(eventName, args) {
      return localStorage.setItem("__StorageEvent__" + eventName, JSON.stringify({
        key: Math.random(),
        content: args
      }));
    };

    StorageEvents.prototype.__trigger = function(eventName, args, th) {
      var func, _i, _len, _ref, _results;
      if (this.events[eventName] !== void 0) {
        _ref = this.events[eventName];
        _results = [];
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          func = _ref[_i];
          _results.push(func.call(th, args));
        }
        return _results;
      }
    };

    return StorageEvents;

  })();

  StorageEvents = new StorageEvents;

  window.addEventListener('storage', function(e) {
    return StorageEvents.__trigger(e.key.slice(16), JSON.parse(e.newValue).content, {});
  });

  window.StorageEvents = StorageEvents;

}).call(this);
