// Generated by IcedCoffeeScript 1.8.0-d
(function() {
  var Auth,
    __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

  Auth = (function() {
    function Auth() {
      this.getToken = __bind(this.getToken, this);
    }

    Auth.prototype.authUrl = "/auth.html";

    Auth.prototype.appId = "14882281488";

    Auth.prototype.iframeElement = null;

    Auth.prototype.type = "popup";

    Auth.prototype.popupWindow = null;

    Auth.prototype.getToken = function(permissions, callback) {
      var npermissions, permission, url, _i, _len, _ref;
      npermissions = [];
      if (typeof permissions === "string") {
        _ref = permissions.split(",");
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          permission = _ref[_i];
          npermissions.push(permission.trim());
        }
      }
      permissions = npermissions;
      if (Array.isArray(permissions)) {
        url = this.authUrl;
        url += "?";
        url += "app_id=";
        url += this.appId;
        url += "&scope=" + permissions.join(",");
        if (this.type === "popup") {
          this.popupWindow = window.open(url);
          return window.addEventListener('message', (function(_this) {
            return function(e) {
              if (e.data.type === "auth_callback") {
                _this.popupWindow.close();
                callback.call(e.data, e.data);
                return window.removeEventListener('message');
              }
            };
          })(this));
        }
      }
    };

    return Auth;

  })();

  window.Auth = Auth;

}).call(this);
